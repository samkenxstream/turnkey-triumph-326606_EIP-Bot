{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/modules/utils/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,uCAAoD;AACpD,iDAA8C;AAEvC,MAAM,EAAE,GAAG,CAAC,GAAG,IAA6B,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAA/D,QAAA,EAAE,MAA6D;AACrE,MAAM,GAAG,GAAG,CAAC,GAAG,IAA6B,EAAE,EAAE,CAAC,gBAAC,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AAAnE,QAAA,GAAG,OAAgE;AAEzE,MAAM,eAAe,GAC1B,CAAC,QAAQ,GAAG,GAAG,EAAE,EAAE,CACnB,CAAC,GAAG,IAA2B,EAAE,EAAE,CACjC,IAAI,CAAC,MAAM,CAAC,kBAAS,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAH7B,QAAA,eAAe,mBAGc;AAE1C,MAAa,eAAe;IAG1B,YAAY,eAAuB,EAAE;QAF9B,YAAO,GAAG,EAAE,CAAC;QAGlB,IAAI,CAAC,OAAO,GAAG,YAAY,CAAC;IAC9B,CAAC;IAED,OAAO,CAAC,IAAY;QAClB,IAAI,CAAC,OAAO,IAAI,KAAK,IAAI,EAAE,CAAC;IAC9B,CAAC;CACF;AAVD,0CAUC;AAEM,MAAM,GAAG,GAAG,CAAC,MAAa,EAAE,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC;AAA3D,QAAA,GAAG,OAAwD;AAExE;;;;;;;;;;GAUG;AACI,MAAM,kBAAkB,GAAG,CAChC,MAAmB,EACnB,OAAsB,EACtB,EAAE;IACF,MAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC,+BAAuB,CAAC,CAAC;IACzD,MAAM,WAAW,GAAG,IAAA,qBAAY,EAAC,GAAG,WAAW,CAAC,CAAC;IACjD,MAAM,UAAU,GAAG,IAAA,+BAAuB,EAAC,MAAM,CAAC,CAAC,MAAM,CACvD,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CACtC,CAAC;IAEF,OAAO,UAAU,CAAC,MAAM,CACtB,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAAC,IAAA,YAAG,EAAC,GAAG,EAAE,IAAI,EAAE,SAAS,CAAC,EACxC,MAAM,CACQ,CAAC;AACnB,CAAC,CAAC;AAdW,QAAA,kBAAkB,sBAc7B;AAEK,MAAM,uBAAuB,GAAG,CAAC,GAAW,EAAE,EAAE;IACrD,SAAS,KAAK,CAAC,CAAS,EAAE,IAAa;QACrC,IAAI,CAAC,CAAC;YAAE,OAAO;QACf,IAAI,OAAO,CAAC,KAAK,QAAQ;YAAE,OAAO,IAAI,CAAC;QACvC,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAChC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAClD,CAAC;IACJ,CAAC;IAED,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,kBAAS,CAAC,CAAC;AAC5D,CAAC,CAAC;AAVW,QAAA,uBAAuB,2BAUlC;AAEK,MAAM,sBAAsB,GAAG,CAAC,GAAW,EAAE,EAAE;IACpD,SAAS,KAAK,CAAC,CAAS,EAAE,IAAa;QACrC,IAAI,OAAO,CAAC,KAAK,QAAQ,IAAI,gBAAC,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE;YACxC,IAAI,CAAC,KAAK,KAAK;gBAAE,OAAO,IAAI,CAAC;YAC7B,OAAO;SACR;QACD,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAChC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAClD,CAAC;IACJ,CAAC;IAED,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,kBAAS,CAAC,CAAC;AAC5D,CAAC,CAAC;AAZW,QAAA,sBAAsB,0BAYjC;AAEK,MAAM,qBAAqB,GAAG,CAAC,GAAW,EAAE,EAAE;IACnD,SAAS,KAAK,CAAC,CAAS,EAAE,IAAa;QACrC,IAAI,OAAO,CAAC,KAAK,QAAQ,EAAE;YACzB,IAAI,gBAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBAAE,OAAO,IAAI,CAAC;YAC7B,OAAO;SACR;QACD,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAChC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAClD,CAAC;IACJ,CAAC;IAED,OAAO,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,kBAAS,CAAC,CAAC;AAC5D,CAAC,CAAC;AAZW,QAAA,qBAAqB,yBAYhC","sourcesContent":["import { isDefined, TestResults } from \"src/domain\";\nimport _, { intersection, set } from \"lodash\";\n\nexport const OR = (...args: [boolean, ...boolean[]]) => args.includes(true);\nexport const AND = (...args: [boolean, ...boolean[]]) => _.every(args, Boolean);\n\nexport const multiLineString =\n  (joinWith = \" \") =>\n  (...args: [string, ...string[]]) =>\n    args.filter(isDefined).join(joinWith);\n\nexport class MultiLineString {\n  public message = \"\";\n\n  constructor(initialValue: string = \"\") {\n    this.message = initialValue;\n  }\n\n  addLine(line: string) {\n    this.message += `\\n${line}`;\n  }\n}\n\nexport const ANY = (states: any[]) => states.filter(Boolean).length > 0;\n\n/**\n * designed to collect the purified results and return the common paths;\n * this is useful because it means that if one error is purified in one\n * purifier but not in others it will be purified in this step, which\n * avoids race conditions and keeps logic linear and shallow (improves\n * readability)\n *\n * @param parent common ancestor between potentially mutated objects\n * @param objects mutated objects from ancestor\n * @returns common paths of the mutated objects relative to the parent\n */\nexport const innerJoinAncestors = (\n  parent: TestResults,\n  objects: TestResults[]\n) => {\n  const objectPaths = objects.map(getAllTruthyObjectPaths);\n  const commonPaths = intersection(...objectPaths);\n  const clearPaths = getAllTruthyObjectPaths(parent).filter(\n    (path) => !commonPaths.includes(path)\n  );\n\n  return clearPaths.reduce(\n    (obj, path) => set(obj, path, undefined),\n    parent\n  ) as TestResults;\n};\n\nexport const getAllTruthyObjectPaths = (obj: object) => {\n  function rKeys(o: object, path?: string) {\n    if (!o) return;\n    if (typeof o !== \"object\") return path;\n    return Object.keys(o).map((key) =>\n      rKeys(o[key], path ? [path, key].join(\".\") : key)\n    );\n  }\n\n  return rKeys(obj).toString().split(\",\").filter(isDefined);\n};\n\nexport const getAllFalseObjectPaths = (obj: object) => {\n  function rKeys(o: object, path?: string) {\n    if (typeof o !== \"object\" || _.isNull(o)) {\n      if (o === false) return path;\n      return;\n    }\n    return Object.keys(o).map((key) =>\n      rKeys(o[key], path ? [path, key].join(\".\") : key)\n    );\n  }\n\n  return rKeys(obj).toString().split(\",\").filter(isDefined);\n};\n\nexport const getAllNullObjectPaths = (obj: object) => {\n  function rKeys(o: object, path?: string) {\n    if (typeof o !== \"object\") {\n      if (_.isNull(o)) return path;\n      return;\n    }\n    return Object.keys(o).map((key) =>\n      rKeys(o[key], path ? [path, key].join(\".\") : key)\n    );\n  }\n\n  return rKeys(obj).toString().split(\",\").filter(isDefined);\n};\n"]}