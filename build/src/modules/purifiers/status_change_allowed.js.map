{"version":3,"file":"status_change_allowed.js","sourceRoot":"","sources":["../../../../src/modules/purifiers/status_change_allowed.ts"],"names":[],"mappings":";;;AAAA,uCAAoD;AACpD,mCAAmC;AACnC,mCAA8B;AAEvB,MAAM,2BAA2B,GAAG,CAAC,WAAwB,EAAE,EAAE;IACtE,MAAM,YAAY,GAAG,IAAA,kBAAS,EAAC,WAAW,CAAC,CAAC;IAC5C,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,YAAY,CAAC;IAE1C,MAAM,qBAAqB,GAAG,IAAA,WAAG,EAAC;QAChC,wCAAwC;QACxC,QAAQ,EAAE,IAAI,CAAC,MAAM,KAAK,kBAAS,CAAC,QAAQ;YAC1C,QAAQ,EAAE,IAAI,CAAC,MAAM,KAAK,kBAAS,CAAC,MAAM;QAC5C,oCAAoC;QACpC,CAAC,MAAM,CAAC,cAAc,CAAC,qBAAqB;KAC7C,CAAC,CAAC;IAEH,IAAI,qBAAqB,EAAE;QACzB,gEAAgE;QAChE,MAAM,CAAC,YAAY,CAAC,mBAAmB,GAAG,SAAS,CAAC;KACrD;IAED,OAAO;QACL,GAAG,WAAW;QACd,MAAM;KACP,CAAC;AACJ,CAAC,CAAC;AArBW,QAAA,2BAA2B,+BAqBtC","sourcesContent":["import { EipStatus, TestResults } from \"src/domain\";\nimport { cloneDeep } from \"lodash\";\nimport { ANY } from \"#/utils\";\n\nexport const statusChangeAllowedPurifier = (testResults: TestResults) => {\n  const _testResults = cloneDeep(testResults);\n  const { errors, fileDiff } = _testResults;\n\n  const isStatusChangeAllowed = ANY([\n    // state changes from lastcall -> review\n    fileDiff?.base.status === EipStatus.lastCall &&\n      fileDiff?.head.status === EipStatus.review,\n    // editors can approve state changes\n    !errors.approvalErrors.isEditorApprovedError\n  ]);\n\n  if (isStatusChangeAllowed) {\n    // always clear the constant status error if changes are allowed\n    errors.headerErrors.constantStatusError = undefined;\n  }\n\n  return {\n    ...testResults,\n    errors\n  };\n};\n"]}